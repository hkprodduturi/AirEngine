# What to Expect from AirEngine

## What AirEngine Is

AirEngine is a **deterministic compiler** for `.air` files. An `.air` file is a structured intermediate representation (IR) that describes a full-stack application in a compact, declarative format.

The pipeline:

```
AI prompt  -->  AI generates .air  -->  AirEngine compiles  -->  You own the code
                (Claude, etc.)         (deterministic)          (React + Express + Prisma)
```

AirEngine is the compiler stage. It takes a `.air` file as input and produces a complete, runnable application as output. The same input always produces the same output — no randomness, no API calls, no black box.

## What AirEngine Is Not

- **Not a template pack.** Every app is compiled fresh from its `.air` definition. There are no hardcoded templates being filled in.
- **Not a black-box prompt toy.** You can read, modify, and own every line of generated code. The `.air` source is human-readable and version-controllable.
- **Not an AI chatbot.** AirEngine itself does not use AI. It's a traditional compiler that happens to work on a format AI models are good at generating.

## What `.air` Files Look Like

A `.air` file uses 16 block types to define an entire application:

```
@app:helpdesk
  @state{...}           # Client-side reactive state
  @style(...)           # Design tokens (theme, colors, fonts)
  @ui(...)              # Component tree (pages, forms, tables)
  @db{...}              # Database models and relations
  @api(...)             # REST API routes
  @auth(...)            # Authentication and RBAC
  @nav(...)             # Client routing
  @persist:x(...)       # Data persistence
  @hook(...)            # Lifecycle hooks
  @env(...)             # Environment variables
  @cron(...)            # Scheduled jobs
  @webhook(...)         # Webhook handlers
  @queue(...)           # Background jobs
  @email(...)           # Email templates
  @deploy(...)          # Deployment config
```

Simple apps might use 3-4 blocks. Complex apps use 10+.

## What the Compiler Generates

### Frontend-only apps (no `@db`/`@api`)

Generated stack: **Vite + React + Tailwind CSS**

```
output/
  index.html
  package.json
  vite.config.js
  tailwind.config.cjs, postcss.config.cjs
  src/
    App.jsx         # Main component with routing
    main.jsx        # Entry point
    index.css       # Tailwind imports + theme variables
    pages/          # One file per @page (when 3+ pages)
```

### Fullstack apps (with `@db`/`@api`)

Generated stack: **React + Tailwind** (client) + **Express + Prisma + SQLite** (server)

```
output/
  client/
    index.html, package.json, vite.config.js
    src/
      App.jsx           # Router with auth guards
      main.jsx, index.css
      pages/            # Lazy-loaded when 3+ pages
      api.js            # API client with token auth
      Layout.jsx        # App shell (sidebar/nav)
      PublicLayout.jsx   # Public page wrapper (if public routes)
      types.ts          # TypeScript type exports
  server/
    server.ts           # Express app with security middleware
    package.json, tsconfig.json
    auth.ts             # JWT (HMAC-SHA256) token handling
    middleware.ts       # Request logging, error handling
    validation.ts       # Request body validation
    routes/             # One file per model (CRUD)
    api.ts              # Route aggregator
    prisma.ts           # Prisma client singleton
    prisma/
      schema.prisma     # Database schema
    seed.ts             # FK-safe seed data (topologically sorted)
    env.ts              # Environment variable validation
    types.ts            # Shared types
  _airengine_manifest.json  # Codegen metadata (version, hashes)
  README.md                 # Generated usage instructions
```

## Security Features (Generated by Default)

Every fullstack app includes:
- **JWT auth** (HMAC-SHA256 via Node crypto) — no third-party auth libraries
- **Request validation** — body fields validated against AIR type definitions
- **Rate limiting** — in-memory, per-IP, auto-cleanup (100 req / 15 min)
- **Helmet** — security headers
- **CORS** — configurable origin
- **express.json limit** — 10MB body size cap

## Scale of Output

| Input | Output Files | Output Lines | Expansion |
|-------|-------------|-------------|-----------|
| 11-line todo.air | 9 files | ~220 lines | 20x |
| 20-line fullstack-todo.air | 24 files | ~1100 lines | 55x |
| 137-line helpdesk.air | 37 files | ~3200 lines | 23x |
| 301-line projectflow.air | 50 files | ~2200 lines | 7x |
| 360-line photography.air | 45 files | ~4000 lines | 11x |

## Performance

- Transpilation: typically **15-50ms** for any app
- Incremental: only regenerates changed files (SHA-256 content hashing)
- Full test suite: **1100+ tests** in ~10 seconds

## What "Working" Looks Like

After transpiling and starting a fullstack app:

1. **Server starts:** `Server running on port 3001`
2. **Health check passes:** `curl http://localhost:3001/api/health` returns `{"status":"ok","db":"connected"}`
3. **Client serves:** Vite dev server on `http://localhost:5173`
4. **App loads:** Browser shows the application with correct theme, navigation, and data
5. **API works:** Seeded data appears in tables/lists, forms submit correctly
6. **Auth works:** Login/register flows function, protected routes redirect

## What the Repo Contains

| Directory | Purpose |
|-----------|---------|
| `src/` | Compiler source (parser, validator, transpiler, CLI, MCP server) |
| `examples/` | 46 `.air` files across 4 tiers (5 flagship, 7 fixtures, 14 gallery, 20 templates) |
| `tests/` | 1100+ vitest tests |
| `scripts/` | Golden runs, eval harnesses, stability sweep, self-heal loop |
| `docs/` | Architecture docs, quickstarts, troubleshooting |
| `benchmarks/` | Eval corpora and benchmark comparison |
| `qa-flows/` | Runtime QA flow definitions (SH8) |

## Next Steps

- [quickstart-local.md](quickstart-local.md) — Set up and run locally
- [run-flagship-apps-locally.md](run-flagship-apps-locally.md) — Step-by-step flagship app instructions
- [troubleshooting-local.md](troubleshooting-local.md) — Fix common issues
